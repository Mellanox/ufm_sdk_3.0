<source>
  @type tail
  path /opt/ufm/files/log/event.log
  pos_file /config/event.pos
  tag ufm-events
  read_from_head true # set it to false if you want to skip the existing logs
  <parse>
    @type regexp
    expression /^(?<timestamp>[\d\-]+ [\d\:\.]+) \[\d+\] \[\d+\] (?<severity>\w+) (?:Site \[[\w-]*\] )?\[(?<event_type>\w+)\] (?<object_type>\w+) \[(?<object_id>.*)\]\: (((?<event>[ \w\/\-]+)((\,|\:|\.)(?<event_details>.*))?)|(?<event_fallback>.*))$/
    time_key timestamp
    time_format %Y-%m-%d %H:%M:%S.%L
  </parse>
</source>

<filter ufm-events>
  @type script
  path /config/fluentd/parse_object_id.rb
</filter>

<match ufm-events>
  @type loki
  url "http://127.0.0.1:3101"
  <buffer>
    @type memory
    flush_interval 10s
  </buffer>
  <label>
    severity
    event_type
    object_type
    object_id
    device_name
    device_guid
    device_type
  </label>
  extra_labels {"job":"ufm-events"}
  line_format json
</match>
